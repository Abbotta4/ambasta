From d2bc585d3d1e887b08b6b4b5887cc27d5a4bd702 Mon Sep 17 00:00:00 2001
From: cd <a@b.com>
Date: Thu, 29 Aug 2019 19:12:39 +0530
Subject: [PATCH] memcpyfix

---
 .../dawn_wire/client/ClientInlineMemoryTransferService.cpp    | 4 ++--
 .../dawn_wire/server/ServerInlineMemoryTransferService.cpp    | 4 ++--
 third_party/dawn/src/include/dawn_wire/WireClient.h           | 2 ++
 third_party/dawn/src/include/dawn_wire/WireServer.h           | 2 ++
 3 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/third_party/dawn/src/dawn_wire/client/ClientInlineMemoryTransferService.cpp b/third_party/dawn/src/dawn_wire/client/ClientInlineMemoryTransferService.cpp
index a8250abd8d..b18f5f74fe 100644
--- a/third_party/dawn/src/dawn_wire/client/ClientInlineMemoryTransferService.cpp
+++ b/third_party/dawn/src/dawn_wire/client/ClientInlineMemoryTransferService.cpp
@@ -39,7 +39,7 @@ namespace dawn_wire { namespace client {
                 }
 
                 mStagingData = std::unique_ptr<uint8_t[]>(new uint8_t[mSize]);
-                memcpy(mStagingData.get(), deserializePointer, mSize);
+                std::memcpy(mStagingData.get(), deserializePointer, mSize);
 
                 ASSERT(data != nullptr);
                 ASSERT(dataLength != nullptr);
@@ -74,7 +74,7 @@ namespace dawn_wire { namespace client {
             size_t SerializeFlush(void* serializePointer) override {
                 if (serializePointer != nullptr) {
                     ASSERT(mStagingData != nullptr);
-                    memcpy(serializePointer, mStagingData.get(), mSize);
+                    std::memcpy(serializePointer, mStagingData.get(), mSize);
                 }
                 return mSize;
             }
diff --git a/third_party/dawn/src/dawn_wire/server/ServerInlineMemoryTransferService.cpp b/third_party/dawn/src/dawn_wire/server/ServerInlineMemoryTransferService.cpp
index cab0c4c6ae..862015d6aa 100644
--- a/third_party/dawn/src/dawn_wire/server/ServerInlineMemoryTransferService.cpp
+++ b/third_party/dawn/src/dawn_wire/server/ServerInlineMemoryTransferService.cpp
@@ -31,7 +31,7 @@ namespace dawn_wire { namespace server {
                                         void* serializePointer) override {
                 if (serializePointer != nullptr && dataLength > 0) {
                     ASSERT(data != nullptr);
-                    memcpy(serializePointer, data, dataLength);
+                    std::memcpy(serializePointer, data, dataLength);
                 }
                 return dataLength;
             }
@@ -48,7 +48,7 @@ namespace dawn_wire { namespace server {
                     deserializePointer == nullptr) {
                     return false;
                 }
-                memcpy(mTargetData, deserializePointer, mDataLength);
+                std::memcpy(mTargetData, deserializePointer, mDataLength);
                 return true;
             }
         };
diff --git a/third_party/dawn/src/include/dawn_wire/WireClient.h b/third_party/dawn/src/include/dawn_wire/WireClient.h
index f35803593a..be7354ac8e 100644
--- a/third_party/dawn/src/include/dawn_wire/WireClient.h
+++ b/third_party/dawn/src/include/dawn_wire/WireClient.h
@@ -16,6 +16,8 @@
 #define DAWNWIRE_WIRECLIENT_H_
 
 #include <memory>
+#include <limits>
+#include <cstring>
 
 #include "dawn_wire/Wire.h"
 
diff --git a/third_party/dawn/src/include/dawn_wire/WireServer.h b/third_party/dawn/src/include/dawn_wire/WireServer.h
index f35803593a..be7354ac8e 100644
--- a/third_party/dawn/src/include/dawn_wire/WireServer.h
+++ b/third_party/dawn/src/include/dawn_wire/WireServer.h
@@ -16,6 +16,7 @@
 #define DAWNWIRE_WIRESERVER_H_
 
 #include <memory>
+#include <cstring>
 
 #include "dawn_wire/Wire.h"
 
-- 
2.23.0

